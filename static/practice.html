<!DOCTYPE html>

<html>
<head>
	<meta charset="UTF-8">

	<title>Japanese practice app</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js" type="text/javascript">
	</script>
	<link href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css" rel="stylesheet">
	<style>

	.header {
	 height: 8rem;
	 background: #009688;
	}

	.content {
	 width: 50rem;
	 margin: -4rem auto 0 auto;
	 padding: 1rem;
	 background: #fff;
	 border-radius: 0.125rem;
	 box-shadow: 0 0.125rem 0.3125rem 0 rgba(0, 0, 0, 0.25);
	}


	button {
  padding: 0;
	font-size: 25px;
	cursor: pointer;
  border-radius: 5px;
  text-align: center;
  margin-right: 30px;
  margin-bottom: 10px;
  position: relative;
  line-height: 50px;
	}
  button:focus {outline:0;}

	.content {
	 -webkit-animation-duration: 0.4s;
	 animation-duration: 0.4s;
	 -webkit-animation-fill-mode: both;
	 animation-fill-mode: both;
	 -webkit-animation-name: slideUp;
	 animation-name: slideUp;
	 -webkit-animation-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
	 animation-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
	}

	.content-div {
	 text-align: center;
	}

	.question {
	 font-size: 50px;
	 font-weight:500;
	 font-family: sans-serif;
	}
	.answer {
	 font-size: 21px;
	 color: white;
	 width: 50%;
	 height: 50%;
	 margin: 0 auto;
	 background: red;
	 align: center;
	 border-radius: 5px;
	}

	.answer-text {
	 margin-bottom: 5px;
	 padding-top: 5px;
	}
	*{padding:0;margin:0;}

  .skip-button {
    background-color: DodgerBlue;
    color: white;
  }

  .category {
    font-size: 20px;
  }
	@-webkit-keyframes slideUp {
	 0% {
	   -webkit-transform: translateY(6.25rem);
	   transform: translateY(6.25rem);
	 }
	 100% {
	   -webkit-transform: translateY(0);
	   transform: translateY(0);
	 }
	}
	@keyframes slideUp {
	 0% {
	   -webkit-transform: translateY(6.25rem);
	   transform: translateY(6.25rem);
	 }
	 100% {
	   -webkit-transform: translateY(0);
	   transform: translateY(0);
	 }
	}

	/* The slider */
	.slider {
	  position: absolute;
	  cursor: pointer;
	  top: 0;
	  left: 0;
	  right: 0;
	  bottom: 0;
	  background-color: #ccc;
	  -webkit-transition: .4s;
	  transition: .4s;
	}

	.slider:before {
	  position: absolute;
	  content: "";
	  height: 26px;
	  width: 26px;
	  left: 4px;
	  bottom: 4px;
	  background-color: white;
	  -webkit-transition: .4s;
	  transition: .4s;
	}

	input:checked + .slider {
	  background-color: #2196F3;
	}

	input:focus + .slider {
	  box-shadow: 0 0 1px #2196F3;
	}

	input:checked + .slider:before {
	  -webkit-transform: translateX(26px);
	  -ms-transform: translateX(26px);
	  transform: translateX(26px);
	}

	/* Rounded sliders */
	.slider.round {
	  border-radius: 34px;
	}

	.slider.round:before {
	  border-radius: 50%;
	}


.search-box,.close-icon,.search-wrapper {
	position: relative;
	padding: 10px;
}
.search-wrapper {
	width: 500px;
	margin: auto;
	margin-top: 50px;
}
.search-box {
	width: 80%;
	border: 1px solid #ccc;
  outline: 0;
  border-radius: 15px;
	font-size: 20px;
}
.search-box:focus {
	box-shadow: 0 0 15px 5px #b0e0ee;
	border: 2px solid #bebede;
}
.close-icon {
	border:1px solid transparent;
	background-color: transparent;
	display: inline-block;
	vertical-align: middle;
  outline: 0;
  cursor: pointer;
}
.close-icon:after {
	content: "X";
	display: block;
	width: 15px;
	height: 15px;
	position: absolute;
	background-color: #FA9595;
	z-index:1;
	right: 35px;
	top: 0;
	bottom: 0;
	margin: auto;
	padding: 2px;
	border-radius: 50%;
	text-align: center;
	color: white;
	font-weight: normal;
	font-size: 12px;
	box-shadow: 0 0 2px #E50F0F;
	cursor: pointer;
}
.search-box:not(:valid) ~ .close-icon {
	display: none;
}

	</style>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/prefixfree/1.0.7/prefixfree.min.js">
	</script>
</head>

<body>
	<header class="header">
	</header>


	<div class="content">

    <div class="content-div answer">
      <p class="answer-text" id="answer-text">Please choose right option</p>
    </div>

    <br>
    <br>


				<div class="content-div category" id="japanaese-example-text">

				 </div>
				<br>
				<br>

				<div class="content-div category" id="english-example-text">

				 </div>
				<br>
				<br>

    <div class="content-div category" id="category-text">
      category
     </div>
		<br>
		<br>

		<div class="content-div question" id="question-text">
			question
		</div>
    <br>
		<br>
		<br>
    <br>
		<br>

		<div class="content-div options">
			<div class="options-buttons" id="optionButtons">
        <button id="option-button-1" onclick="checkResult(1)">
          option 1
        </button>
        <button id="option-button-2" onclick="checkResult(2)">
          option 2
        </button>
        <button id="option-button-3" onclick="checkResult(3)">
          option 3
        </button>
      </div>
			<form onsubmit="return false">
	<input type="text" id="optionText" required class="search-box" autofocus />
		<button class="close-icon" type="reset"></button>
	</form>
		</div>
    <br>
    <br>
    <br>
    <br>

		<div class="content-div skip">
			<button class="skip-button" onclick="skipQuestion()">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; skip &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<button>
		</div>
	</div>
	<script>

	String.prototype.replaceAll = function(search, replacement) {
	    var target = this;
	    return target.split(search).join(replacement);
	};

	   getWords();
     var current = 0, prev = 0
     data = []
     dataSize = 609 - 1
     answerButtonPlace = 0
		 isEnglishToJapanese = false

		 var OptionsType = {
			 optionText : { name: "optionText" },
			 optionButtons : { name: "optionButtons" }
		 }

		 questionKey = "hiragana"
		 optionKey = "word" // "word"  "hiragana"
		 optionType = OptionsType.optionButtons

		 if(optionType == OptionsType.optionText) {
			 document.getElementById(OptionsType.optionButtons.name).style.display = 'none'
		 } else {
			 document.getElementById(OptionsType.optionText.name).style.display = 'none'
		 }

		 document.getElementById("optionText")
		     .addEventListener("keyup", function(event) {
		     event.preventDefault();
		     if (event.keyCode === 13) {
		         checkResult()
		     }
		 });


		 function toggleLanguage() {
			 var temp = questionKey
			 questionKey = optionKey
			 optionKey = temp
		 }

	   function getWords() {
       getCategories(function (categories) {
         var param = {}
         param["category"] = categories
         callAjax("/get/words", "POST", param , function(response) {
           data = response
           dataSize = data.length - 1
           updateCurrentData()
         })
	     })
	   }

	   // Track event
	     function callAjax(url,method, param, callback) {
	         // compatible with IE7+, Firefox, Chrome, Opera, Safari
	         var xmlhttp = new XMLHttpRequest();
	         xmlhttp.onreadystatechange = function(){
	             if (xmlhttp.readyState == 4 && xmlhttp.status == 200){
	                 callback(JSON.parse(xmlhttp.response));
	             }
	         }
	         xmlhttp.open(method, url, true);
	         xmlhttp.setRequestHeader("Content-type", "application/json");
           console.log(param);
	         xmlhttp.send(JSON.stringify(param));
	     }

       function getCategories(callback) {
           if (typeof(Storage) !== "undefined") {

             categories = localStorage.getItem("categories");
             if(categories == undefined) {
                 window.location.href = "/"
             } else {
               callback(JSON.parse(categories))
             }
           } else {
               alert("Sorry, your browser does not support Web Storage...");
           }
       }

       function appendSpecingToText(text) {
          return "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" + text + "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
       }

       function updateCurrentData() {
         prev = current

         getRandomInt(1, dataSize, [], callback = function(random) {
					 current = random
					 if(prev != 0) {
	           let answerText = data[prev][questionKey] + " = " + data[prev][optionKey]
	           document.getElementById("answer-text").innerHTML = answerText
						 document.getElementById("japanaese-example-text").innerHTML = data[prev]["exampleJapanese"] || ""
						document.getElementById("english-example-text").innerHTML = data[prev]["exampleEnglish"] || ""

	         }
	           document.getElementById("question-text").innerHTML = data[current][questionKey]
	           document.getElementById("category-text").innerHTML = data[current]["category"]

	           setOptionButtonTexts()
				 })
         }

       function setOptionButtonTexts() {
         getRandomInt(1, 3, [], callback= function(random) {
					 answerButtonPlace = random
					 getRandomInt(0, dataSize, [current], callback = function(random) {
						 answerButtonPlace2Data = random
						 getRandomInt(0, dataSize, [current, answerButtonPlace2Data], callback = function(random) {
							 answerButtonPlace3Data = random
							 document.getElementById("option-button-" + answerButtonPlace).innerHTML =  appendSpecingToText(data[current][optionKey])

							 if(answerButtonPlace == 1) {
								 document.getElementById("option-button-" + 2).innerHTML = appendSpecingToText(data[answerButtonPlace2Data][optionKey])
								 document.getElementById("option-button-" + 3).innerHTML = appendSpecingToText(data[answerButtonPlace3Data][optionKey])
							 } else if(answerButtonPlace == 2) {
								 document.getElementById("option-button-" + 1).innerHTML = appendSpecingToText(data[answerButtonPlace2Data][optionKey])
								 document.getElementById("option-button-" + 3).innerHTML = appendSpecingToText(data[answerButtonPlace3Data][optionKey])
							 } else {
								 document.getElementById("option-button-" + 1).innerHTML = appendSpecingToText(data[answerButtonPlace2Data][optionKey])
								 document.getElementById("option-button-" + 2).innerHTML = appendSpecingToText(data[answerButtonPlace3Data][optionKey])
							 }
						 })
					 })
				 })
       }

       function checkResult(optionNumber) {
         answerDivColor = "red"

				 optionTextRaw = document.getElementById("optionText").value.toLowerCase()
				 optionText = data[current][optionKey].toLowerCase().replaceAll(" ", "")
				 optionText = optionText.replaceAll("to", "")
				 optionText = optionText.replace("the", "")
				 optionText = optionText.replace("\n", "")

				 optionTextAlternatives = optionText.split(",")
				 console.log(optionTextAlternatives)
         if(optionNumber == answerButtonPlace || optionTextAlternatives.includes(optionTextRaw)) {
           answerDivColor = "#5cb85c";
         }
				   document.getElementById("optionText").value = ""
           document.getElementsByClassName("answer")[0].style.backgroundColor = answerDivColor;

           updateCurrentData()
       }


       function getRandomInt(min, max, exclude, callback) {
				 x= Math.random()
         random = Math.floor(x * (max - min + 1)) + min;
         if(!exclude.includes(random)) {
           callback(random)
         } else {
					 getRandomInt(min, max, exclude, callback)
				 }
       }

       function skipQuestion() {
				 document.getElementsByClassName("answer")[0].style.backgroundColor = "red";
				 updateCurrentData()       }
	</script>
</body>
</html>
